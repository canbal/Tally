{% extends "manager/base_manager.html" %}

{% block head %}
<script type="text/javascript">  
    function handleFileSelect(evt) {
        var files = evt.target.files;
        var show = [];
        var form = [];
        for (var i = 0, f; f = files[i]; i++) {
            show.push('<li>', escape(f.name), '</li>');
            form.push('<input type="hidden" name=', escape(f.type), ' value=', escape(f.name), '>')
        }
        $("#files_show").html(show.join(''));
        $("#files_form").html(form.join(''));
    }
    $(document).ready(function(){
        $("#files").on('change',handleFileSelect);
    });
</script>
{% endblock head %}

{% block header %}
    Create test page
{% endblock header %}

{% block content %}
<form id="test_create_form" action="" method="post">
    {% csrf_token %}
    
    <span style="color:red;font-weight:bold;font-size:1.1em">
    {{ tf.non_field_errors }}
    {% for field in tf %}
        {% if field.errors %}{{ field.label }}:{{ field.errors }}{% endif %}
    {% endfor %}
    </span>
        
    <div data-role="fieldcontain">
        {% for field in tf %}
            <p><label for="id_{{ field.html_name }}">{{ field.label }}: </label>{{ field }}</p>
        {% endfor %}
    </div>
    <input type="hidden" id="files_json" name="files_json" value="[]">
</form>

<input type="file" id="files" name="files" multiple>
    
<ol id="files_show"></ol>

<input id="create_button" type="button" value="Create">

<form id="files_form" name="files_form"></form>

<script type="text/javascript">  
    $("#create_button").click((function(evt) {
        var form = $(document.files_form);
        var vids = JSON.stringify(form.serializeArray());

        document.getElementById('files_json').value = vids;
        document.forms['test_create_form'].submit();
    }));
</script>
{% endblock content %}

