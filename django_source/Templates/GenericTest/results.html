
{% extends "base_subject.html" %}

{% block head %}
    <script type="text/javascript">
        function timeSubmit() {
            var t=setTimeout("autosubmit()",2000);     {# milliseconds #}
        }
        function autosubmit() {
            document.secretForm.submit();
        }
    </script>
{% endblock head %}

{% block header %}
    {% if testInstance.counter == 0 %}
        Welcome!
    {% else %}
        {% if testInstance.counter > maxCount %}        {# elif currently only supported in django dev version #}
            Test Complete
        {% else %}
            Test {{ testInstance.counter }}/{{ maxCount }}
        {% endif %}
    {% endif %}
{% endblock header %}

{% block content %}
    {% if testInstance.counter <= maxCount %}
        {% if testInstance.counter == 0 %}
            <p>Waiting for other participants.  Test will begin shortly...</p>
        {% else %}
            {% if error_message %}<p><strong>{{ error_message }}</strong></p>
            {% else %}
                <p>Results submitted.  Waiting for other participants or video to finish...</p>
            {% endif %}
        {% endif %}
       <form name="secretForm", action="/{{ testInstance.pk }}/tally/" method="post" data-ajax="false">
            {% csrf_token %}
            <input type="hidden" name="value" value="queryState" />
            <input type="hidden" name="prevCount" value={{ testInstance.counter }} />
        </form>	
        <script type="text/javascript">
            timeSubmit();
        </script>
    {% else %}
        <p>Thank you for your participation!</p>
        <span style="float:right">
            <a href="/logout" data-role="button" data-theme="b" data-inline="true" data-icon="check" data-ajax="false">Logout</a>
        </span>
    {% endif %}
{% endblock content %}
